<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head"/>
<body>
<!-- Barra de Navegación superior -->
<nav th:replace="fragments/nav"/>
<div class="container">
 
<h2>Productos</h2>
 

 
 <form class="navbar-form" action="/product/list">
 
<div class="form-group">
 
<input name="searchText" type="text" class="form-control" size="50"
 
placeholder="Buscar por descripción o nombre del producto">
 
</div>
 
<button type="submit" class="btn btn-default">Buscar</button>
</form>

<p>Las productos que actualmente figuran en el sistema son las siguientes:</p>

<button type="button" id="updateButton" class="btn btn-default">Actualizar</button>
 
<script th:inline="javascript">
/*<![CDATA[*/
	$( "#updateButton" ).click(function() {
 
var numberPage = [[${param.page}]];
 
var urlUpdate = '/product/list/update';
 
if (numberPage != null ){
 
urlUpdate += "?page="+numberPage[0];
 
}
 
$("#tableProducts").load(urlUpdate);
 
});
 
/*]]>*/
	
	
 
$( "#updateButton" ).click(function() {
 
$("#tableProducts").load('/product/list/update');
 
});
 
</script>
 
 
 
 
<div class="table-responsive">
 
 
<table class="table table-hover" th:fragment="tableProducts" id="tableProducts">
 
<thead>
 
<tr>
 
<th class="col-md-1">id</th>
 
<th>Descripción</th>
 
<th>Precio</th>
 
<th class="col-md-1"> </th>
 
<th class="col-md-1"> </th>

<th class="col-md-1"> </th>
 
</tr>
 
</thead>
 
<tbody>
 
<tr th:each="product : ${productList}">
 
<td th:text="${product.id}"> 1</td>
 
<td th:text="${product.description}"> Ejercicio 1</td>
 
<td th:text="${product.price}">10</td>
 
<td><a th:href="${'/product/details/' + product.id}">detalles</a></td>
 
<td><a sec:authorize="hasRole('ROLE_ADMIN')"
 
th:href="${'/product/edit/' + product.id}">modificar</a>
 
 
<div sec:authorize="hasRole('ROLE_USER')" >
 
<div th:if="${product.sold}">
 
<button type="button" th:id="${'resendButton' + product.id}"
 
class="btn btn-info">Reenviar</button>
 
<script th:inline="javascript">
 
/*<![CDATA[*/
$( "#resendButton[[${product.id}]]" ).click(function() {
 
$.get( "/product/[[${product.id}]]/noresend", function( data ) {
	var numberPage = [[${param.page}]];
	 
	var urlUpdate = '/product/list/update';
	 
	 
	if ( numberPage != null ){
	 
	urlUpdate += "?page="+numberPage[0];
	 
	}
	$("#tableProducts").load(urlUpdate);

});
 
});
/*]]>*/
 
</script>
 
 
</div>
 
<div th:unless="${product.sold}">
<button type="button" th:id="${'noresendButton' + product.id}"
 
class="btn btn-default">No reenviar</button>
 
<script th:inline="javascript">
 
/*<![CDATA[*/
$( "#noresendButton[[${product.id}]]" ).click(function() {
 
$.get( "/product/[[${product.id}]]/resend", function( data ) {
	var numberPage = [[${param.page}]];
	 
	var urlUpdate = '/product/list/update';
	 
	if ( numberPage != null ){
	 
	urlUpdate += "?page="+numberPage[0];
	 
	}
	$("#tableProducts").load(urlUpdate);

});
});

</script>


 
</div>
 
</div>
 
</td>
 
<td><a sec:authorize="hasRole('ROLE_ADMIN')"
 
th:href="${'/product/delete/' + product.id}">eliminar</a>
 
</td>
 
</tr>
 
 
</tbody>
 
</table>
 
</div>
<footer th:replace="fragments/pagination"/>

</div>
<footer th:replace="fragments/footer"/>

</body>
</html>